<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <title>Car Price Tracking</title>
</head>
<body>
<div style="width: 50%;margin: auto;">
    <h1>Seja bem vindo!</h1>
    <br>

    <label for="marcas">Marca:</label>
    <select class="form-select" name="marcas" id="marcas">
        <option selected value="0">-- Selecione uma marca --</option>
        <option th:each="marca : ${marcas}"
                th:value="${marca.getCodigo()}"
                th:text="${marca.getNome()}">
        </option>
    </select>

    <br>

    <label for="modelos">Modelo:</label>
    <select class="form-select" name="modelos" id="modelos" disabled>
        <option selected value="0">-- Selecione um modelo --</option>
    </select>

    <button class="btn btn-primary" id="submeter_pesquisa" onclick="gerarTabelaFiltrada()">Submeter</button>

    <table class="table table-striped" id="table-veiculos" style="display: none">
        <thead>
            <tr>
                <th>Codigo</th>
                <th>Nome</th>
                <th>Valor</th>
                <th>Combust√≠vel</th>
            </tr>
        </thead>
        <tbody class="table-group-divider" id="tabela-veiculos-content">
        </tbody>
    </table>
</div>

<script>
    document.getElementById('marcas').addEventListener('change', function () {
        const marcaCodigo = this.value;
        const modeloSelect = document.getElementById('modelos');

        if (marcaCodigo === "0") {
            modeloSelect.innerHTML = '<option selected value="0">-- Selecione um modelo --</option>';
            modeloSelect.disabled = true;
            return;
        }

        fetch('/modelos/' + marcaCodigo)
            .then(response => response.json())
            .then(data => {
                modeloSelect.innerHTML = '<option selected value="0">-- Selecione um modelo --</option>';
                data.forEach(modelo => {
                    const option = document.createElement('option');
                    option.value = modelo.codigo;
                    option.textContent = modelo.nome;
                    modeloSelect.appendChild(option);
                });
                modeloSelect.disabled = false;
            })
            .catch(error => {
                console.error('Erro ao buscar modelos:', error);
                modeloSelect.disabled = true;
            });
    });
    function gerarTabelaFiltrada() {
        const marcaSelect = document.getElementById('marcas');
        const modeloSelect = document.getElementById('modelos');
        const tablebody = document.getElementById('table-veiculos');
        const tableContent = document.getElementById('tabela-veiculos-content');

        if (marcaSelect.value === "0" || modeloSelect.value === "0") {
            tablebody.style.display = "none";
            return;
        }

        fetch('/veiculosModelo/'+modeloSelect.value)
            .then(response => response.json())
            .then(data => {
                data.forEach(veiculo => {
                    const table_line = document.createElement('tr');

                    const td_codigo = document.createElement('td');
                    td_codigo.innerHTML = veiculo.codigoFipe;

                    const td_nome = document.createElement('td');
                    td_nome.innerHTML = veiculo.modelo.nome + " - " + veiculo.ano;

                    const td_combustivel = document.createElement('td');
                    td_combustivel.innerHTML = veiculo.combustivel;

                    const td_valor = document.createElement('td');
                    td_valor.innerHTML = veiculo.valor;

                    table_line.appendChild(td_codigo);
                    table_line.appendChild(td_nome);
                    table_line.appendChild(td_valor);
                    table_line.appendChild(td_combustivel);

                    tableContent.appendChild(table_line);
                });
                tablebody.style.display = "block";
            })
            .catch(error => {
                console.error('Erro ao buscar veiculos:', error);
                tablebody.style.display = "none"
            });
    }
</script>
</body>
</html>
